## 目录

- [TCP 与 UDP 比较](#TCP-与-UDP-比较)
- [UDP 报文格式](#UDP-报文格式)
- [IP 报文格式](#IP-报文格式)
- [TCP 报文格式](#TCP-报文格式)
- [三次握手](#三次握手)
- [四次挥手](#四次挥手)

## TCP 与 UDP 比较

|  | TCP | UDP |
| :-----:| :----: | :----: |
| 英文全称 | Transmission Control Protocol | User Data Protocol |
| 中文 | 传输控制协议 | 用户数据报协议 |
| 可靠性 | 可靠 | 不可靠 |
| 连接性 | 面向连接 | 无连接 |
| 报文/字节流<sup>[1]</sup> | 面向字节流 | 面向报文 |
| 传输效率 | 低 | 高 |
| 传输速度 | 慢 | 快 |
| 双工性 | 全双工 | 一对一、一对多、多对一、多对多 |
| 拥塞控制 | 有（滑动窗口） | 无 |
| 应用举例 | FTP、http、ssh、telnet... | 即时通讯（QQ<sup>[2]</sup> 聊天）、在线视频、网络语音电话... |

<sup>[1]</sup><sub>字节流和报文的区别可以参考：[关于 TCP 流模式与 UDP数 据报文模式区别](https://blog.csdn.net/hanchaoman/article/details/6409106) 和 [TCP stream vs UDP message](https://stackoverflow.com/questions/17446491/tcp-stream-vs-udp-message)</sub>。

<sup>[2]</sup><sub>[QQ 为什么以 UDP 协议为主，以 TCP 协议为辅？](https://www.zhihu.com/question/20292749)</sub>

## UDP 报文格式

![](https://github.com/EthsonLiu/personal-notes/blob/master/_image/014.png)

- **源端口（Source Port）**

    16 位，数据发送方的端口号。

- **目的端口（Destination Port）**

    16 位，数据接受方的端口号。
    
- **UDP 长度（Source Port）**

    16位，头部和数据的长度。

- **校验和（Checksum）**

    16 位校验。

## IP 报文格式

![](https://github.com/EthsonLiu/personal-notes/blob/master/_image/015.png)

参考：<http://www.networksorcery.com/enp/protocol/ip.htm>

- **版本（Version）**

    4 位，指定 IP 数据包头的格式。例如 IPv4 的值为 0100，IPv6 的值为 0110。

- **首部长度（IHL, Internet Header Length）**

    4 位，IP 报头的长度，即固定部分的长度（20 字节）和可变部分的长度之和。最大为 1111，即 10 进制的 15，代表 IP 报头的最大长度可以为 15 个32bits（4 字节），也就是最长可为 15 * 4 = 60 字节，除去固定部分的长度 20 字节，可变部分的长度最大为 40 字节。一般来说此处的值为 0101，表示头长度为 20 字节。

- **区分服务（Differentiated Services）**

    8 位。原先这里是服务类型（TOS, Type of Service），后被摒弃。

- **总长度（Total length）**

    16 位，即 IP 包最大长度可以达 2<sup>16</sup> = 65535 字节。不过由于链路层的 MTU 限制。超过 1480 字节后就会被分片（以太帧 MTU 为 1500 的情况下，除去 20 字节的包头）


## TCP 报文格式

![](https://github.com/EthsonLiu/personal-notes/blob/master/_image/013.png)

参考：<http://www.networksorcery.com/enp/protocol/tcp.htm#Sequence%20Number>

- **源端口（Source Port）**

    16 位，数据发送方的端口号。

- **目的端口（Destination Port）**

    16 位，数据接受方的端口号。

- **序号（Sequence Number）**

    32 位，






## 三次握手

## 四次挥手
